Output directory: spike_analysis/default_model
Log file: spike_analysis/default_model/analysis_log.txt
Running analysis on: CUDA
Loading EHWGesture dataset...
The directory [data/ehwgesture/frames_number_16_split_by_number] already exists.
Dataset loaded: 9708 samples
Creating model...
AAAAAAAAAAAAAAAAAA WRONG SPSSSS VALUE AAAAAAAAAAAAAAA
Using XiSPS v1: alpha =  2.0

============================================================
FIXED PARAMETERS: 392,726
============================================================
  patch_embed_proj_conv                           1,280 (  0.3%)
  patch_embed_proj_conv1                         73,984 ( 18.8%)
  patch_embed_proj_conv2                        311,808 ( 79.4%)
  head                                            5,654 (  1.4%)

============================================================
VARIABLE PARAMETERS: [202,160, 2,108,800]
============================================================
  patch_embed_proj_conv3                   [74,240, 590,336]
  block_0_mlp                              [33,728, 528,128]
  block_0_attn                             [30,232, 231,104]
  block_1_mlp                              [33,728, 528,128]
  block_1_attn                             [30,232, 231,104]

============================================================
TOTAL MODEL SIZE:
  Minimum: 594,886
  Maximum: 2,501,526
============================================================

Loading checkpoint from logs/xisps2-elastic_alpha2.0_t32/spikformer_b8_T32_Ttrain32_wd0.06_adamw_cnf_ADD/lr0.001/checkpoint_max_test_acc1.pth...
Checkpoint loaded. <All keys matched successfully>
--- Registering Hooks ---
Successfully identified 18 LIF layers.

Loading a batch of real data...
Input shape: torch.Size([16, 16, 2, 160, 160]), Labels: [9, 0, 13, 8, 14, 16, 0, 2, 20, 13, 8, 9, 18, 21, 3, 6]

====================================================================================================
====================================================================================================
GRANULARITY: [0, 0, 0]
====================================================================================================
--- Running Forward Pass (T=16) ---

Layer Name                                         | Output Shape                     | Spikes   | Firing Rate 
----------------------------------------------------------------------------------------------------
patch_embed.proj_lif                               | [16, 16, 64, 80, 80]             | 774438   | 0.0074
patch_embed.proj_lif1                              | [16, 16, 128, 40, 40]            | 2335246  | 0.0445
patch_embed.proj_lif2                              | [16, 16, 256, 20, 20]            | 528589   | 0.0202
patch_embed.proj_lif3                              | [16, 16, 256, 10, 10]            | 258769   | 0.0395
block.0.attn.q_lif                                 | [16, 16, 256, 100]               | 40134    | 0.0061
block.0.attn.k_lif                                 | [16, 16, 256, 100]               | 45551    | 0.0070
block.0.attn.v_lif                                 | [16, 16, 256, 100]               | 30404    | 0.0046
block.0.attn.attn_lif                              | [16, 16, 256, 100]               | 104172   | 0.0159
block.0.attn.proj_lif                              | [16, 16, 256, 100]               | 496330   | 0.0757
block.0.mlp.fc1_lif                                | [16, 16, 64, 100]                | 147479   | 0.0900
block.0.mlp.fc2_lif                                | [16, 16, 256, 100]               | 261861   | 0.0400
block.1.attn.q_lif                                 | [16, 16, 256, 100]               | 43326    | 0.0066
block.1.attn.k_lif                                 | [16, 16, 256, 100]               | 25210    | 0.0038
block.1.attn.v_lif                                 | [16, 16, 256, 100]               | 27962    | 0.0043
block.1.attn.attn_lif                              | [16, 16, 256, 100]               | 55790    | 0.0085
block.1.attn.proj_lif                              | [16, 16, 256, 100]               | 112710   | 0.0172
block.1.mlp.fc1_lif                                | [16, 16, 64, 100]                | 298549   | 0.1822
block.1.mlp.fc2_lif                                | [16, 16, 256, 100]               | 609994   | 0.0931
----------------------------------------------------------------------------------------------------
WHOLE MODEL per T per N                            | 1062400                          | 24205    | 0.0228
WHOLE MODEL PER N                                  | 16998400                         | 387282   | 0.0228

Granularity Parameters: 594886

====================================================================================================
====================================================================================================
GRANULARITY: [1, 1, 1]
====================================================================================================
--- Running Forward Pass (T=16) ---

Layer Name                                         | Output Shape                     | Spikes   | Firing Rate 
----------------------------------------------------------------------------------------------------
patch_embed.proj_lif                               | [16, 16, 64, 80, 80]             | 774438   | 0.0074
patch_embed.proj_lif1                              | [16, 16, 128, 40, 40]            | 2335246  | 0.0445
patch_embed.proj_lif2                              | [16, 16, 256, 20, 20]            | 528589   | 0.0202
patch_embed.proj_lif3                              | [16, 16, 256, 10, 10]            | 367050   | 0.0560
block.0.attn.q_lif                                 | [16, 16, 256, 100]               | 143432   | 0.0219
block.0.attn.k_lif                                 | [16, 16, 256, 100]               | 100157   | 0.0153
block.0.attn.v_lif                                 | [16, 16, 256, 100]               | 84843    | 0.0129
block.0.attn.attn_lif                              | [16, 16, 256, 100]               | 257451   | 0.0393
block.0.attn.proj_lif                              | [16, 16, 256, 100]               | 649269   | 0.0991
block.0.mlp.fc1_lif                                | [16, 16, 160, 100]               | 416373   | 0.1017
block.0.mlp.fc2_lif                                | [16, 16, 256, 100]               | 266847   | 0.0407
block.1.attn.q_lif                                 | [16, 16, 256, 100]               | 124270   | 0.0190
block.1.attn.k_lif                                 | [16, 16, 256, 100]               | 78367    | 0.0120
block.1.attn.v_lif                                 | [16, 16, 256, 100]               | 92464    | 0.0141
block.1.attn.attn_lif                              | [16, 16, 256, 100]               | 124222   | 0.0190
block.1.attn.proj_lif                              | [16, 16, 256, 100]               | 322429   | 0.0492
block.1.mlp.fc1_lif                                | [16, 16, 160, 100]               | 586754   | 0.1433
block.1.mlp.fc2_lif                                | [16, 16, 256, 100]               | 643694   | 0.0982
----------------------------------------------------------------------------------------------------
WHOLE MODEL per T per N                            | 1081600                          | 30843    | 0.0285
WHOLE MODEL PER N                                  | 17305600                         | 493493   | 0.0285

Granularity Parameters: 824886

====================================================================================================
====================================================================================================
GRANULARITY: [2, 2, 2]
====================================================================================================
--- Running Forward Pass (T=16) ---

Layer Name                                         | Output Shape                     | Spikes   | Firing Rate 
----------------------------------------------------------------------------------------------------
patch_embed.proj_lif                               | [16, 16, 64, 80, 80]             | 774438   | 0.0074
patch_embed.proj_lif1                              | [16, 16, 128, 40, 40]            | 2335246  | 0.0445
patch_embed.proj_lif2                              | [16, 16, 256, 20, 20]            | 528589   | 0.0202
patch_embed.proj_lif3                              | [16, 16, 256, 10, 10]            | 438912   | 0.0670
block.0.attn.q_lif                                 | [16, 16, 256, 100]               | 442532   | 0.0675
block.0.attn.k_lif                                 | [16, 16, 256, 100]               | 216299   | 0.0330
block.0.attn.v_lif                                 | [16, 16, 256, 100]               | 205204   | 0.0313
block.0.attn.attn_lif                              | [16, 16, 256, 100]               | 434849   | 0.0664
block.0.attn.proj_lif                              | [16, 16, 256, 100]               | 766170   | 0.1169
block.0.mlp.fc1_lif                                | [16, 16, 416, 100]               | 931176   | 0.0874
block.0.mlp.fc2_lif                                | [16, 16, 256, 100]               | 406521   | 0.0620
block.1.attn.q_lif                                 | [16, 16, 256, 100]               | 275374   | 0.0420
block.1.attn.k_lif                                 | [16, 16, 256, 100]               | 180193   | 0.0275
block.1.attn.v_lif                                 | [16, 16, 256, 100]               | 245212   | 0.0374
block.1.attn.attn_lif                              | [16, 16, 256, 100]               | 215168   | 0.0328
block.1.attn.proj_lif                              | [16, 16, 256, 100]               | 408325   | 0.0623
block.1.mlp.fc1_lif                                | [16, 16, 416, 100]               | 938283   | 0.0881
block.1.mlp.fc2_lif                                | [16, 16, 256, 100]               | 481977   | 0.0735
----------------------------------------------------------------------------------------------------
WHOLE MODEL per T per N                            | 1132800                          | 39939    | 0.0353
WHOLE MODEL PER N                                  | 18124800                         | 639029   | 0.0353

Granularity Parameters: 1350806

====================================================================================================
====================================================================================================
GRANULARITY: [3, 3, 3]
====================================================================================================
--- Running Forward Pass (T=16) ---

Layer Name                                         | Output Shape                     | Spikes   | Firing Rate 
----------------------------------------------------------------------------------------------------
patch_embed.proj_lif                               | [16, 16, 64, 80, 80]             | 774438   | 0.0074
patch_embed.proj_lif1                              | [16, 16, 128, 40, 40]            | 2335246  | 0.0445
patch_embed.proj_lif2                              | [16, 16, 256, 20, 20]            | 528589   | 0.0202
patch_embed.proj_lif3                              | [16, 16, 256, 10, 10]            | 453299   | 0.0692
block.0.attn.q_lif                                 | [16, 16, 256, 100]               | 936662   | 0.1429
block.0.attn.k_lif                                 | [16, 16, 256, 100]               | 340127   | 0.0519
block.0.attn.v_lif                                 | [16, 16, 256, 100]               | 323214   | 0.0493
block.0.attn.attn_lif                              | [16, 16, 256, 100]               | 509683   | 0.0778
block.0.attn.proj_lif                              | [16, 16, 256, 100]               | 795037   | 0.1213
block.0.mlp.fc1_lif                                | [16, 16, 1024, 100]              | 1106343  | 0.0422
block.0.mlp.fc2_lif                                | [16, 16, 256, 100]               | 454365   | 0.0693
block.1.attn.q_lif                                 | [16, 16, 256, 100]               | 567782   | 0.0866
block.1.attn.k_lif                                 | [16, 16, 256, 100]               | 268584   | 0.0410
block.1.attn.v_lif                                 | [16, 16, 256, 100]               | 413595   | 0.0631
block.1.attn.attn_lif                              | [16, 16, 256, 100]               | 254026   | 0.0388
block.1.attn.proj_lif                              | [16, 16, 256, 100]               | 436134   | 0.0665
block.1.mlp.fc1_lif                                | [16, 16, 1024, 100]              | 1137392  | 0.0434
block.1.mlp.fc2_lif                                | [16, 16, 256, 100]               | 422633   | 0.0645
----------------------------------------------------------------------------------------------------
WHOLE MODEL per T per N                            | 1254400                          | 47098    | 0.0375
WHOLE MODEL PER N                                  | 20070400                         | 753571   | 0.0375

Granularity Parameters: 2501526

====================================================================================================
Generating Bar Plots...
====================================================================================================
Saved: spike_analysis/default_model/spikes_per_layer.png
Saved: spike_analysis/default_model/firing_rate_per_layer.png

Plotting complete!
All outputs saved to: spike_analysis/default_model
